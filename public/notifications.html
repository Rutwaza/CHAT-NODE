<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notifications</title>
    <style>
        body {
            background-color: #1e1e1e;
            color: #33ff33;
            font-family: 'Roboto Mono', monospace;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #33ff33;
            margin: 0;
        }

        #notifications-container {
            padding: 20px;
            max-width: 800px;
            margin: 20px auto;
        }

        .notification {
            border: 2px solid #33ff33;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.85);
            box-shadow: 0 0 5px #33ff33;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .notification:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px #33ff33;
        }
    </style>
</head>
<body>
    <h1>Notifications</h1>
    <div id="notifications-container">
        <!-- Notifications will be inserted here -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.1/socket.io.min.js"></script>
    <script>
        // Connect to the socket server
        const socket = io.connect('http://localhost:8000');

        // Fetch initial notifications when page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchNotifications();
            markNotificationsAsRead(); // Mark notifications as read when the page loads
        });

        function fetchNotifications() {
            console.log('Fetching notifications...');

            fetch('/api/notifications')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(notifications => {
                    console.log('Notifications fetched:', notifications);
                    const container = document.getElementById('notifications-container');
                    container.innerHTML = ''; // Clear existing content

                    notifications.forEach(notification => {
                        const div = document.createElement('div');
                        div.className = 'notification';
                        div.textContent = `${notification.message} - ${new Date(notification.timestamp).toLocaleString()}`;
                        container.appendChild(div);
                    });
                })
                .catch(error => {
                    console.error('Error fetching notifications:', error);
                });
        }

        function markNotificationsAsRead() {
            fetch('/api/mark-notifications-as-read', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Optionally, you can handle success feedback here
                        console.log('Notifications marked as read');
                    }
                })
                .catch(error => {
                    console.error('Error marking notifications as read:', error);
                });
        }

        // Listen for real-time notification updates
        socket.on('new-notification', (data) => {
            console.log('New notification received:', data);
            const { message } = data;
            const container = document.getElementById('notifications-container');

            // Create and append new notification
            const div = document.createElement('div');
            div.className = 'notification';
            div.textContent = message;
            container.appendChild(div);
        });

        // Debugging: Log when connected and disconnected from socket server
        socket.on('connect', () => {
            console.log('Connected to socket server');
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from socket server');
        });
    </script>
</body>
</html>
